<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Timeline Debug</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #f5f5f5;
    }
    .debug-section {
      background: white;
      padding: 20px;
      margin: 10px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .debug-section h2 {
      margin-top: 0;
      color: #333;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    .success {
      color: green;
      font-weight: bold;
    }
    .warning {
      color: orange;
      font-weight: bold;
    }
    pre {
      background: #f0f0f0;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>Timeline Debug Tool</h1>

  <div class="debug-section">
    <h2>1. Data Loading Test</h2>
    <div id="data-load-status">Testing...</div>
  </div>

  <div class="debug-section">
    <h2>2. Filtering Tests</h2>
    <div id="filter-tests">Testing...</div>
  </div>

  <div class="debug-section">
    <h2>3. Event Sample</h2>
    <div id="event-sample">Loading...</div>
  </div>

  <div class="debug-section">
    <h2>4. Browser Console</h2>
    <p>Open browser console (F12) to see additional debug output</p>
  </div>

  <script src="js/data.js"></script>
  <script>
    // Test 1: Check if data loaded
    const dataLoadStatus = document.getElementById('data-load-status');
    if (typeof timelineEvents === 'undefined') {
      dataLoadStatus.innerHTML = '<span class="error">❌ FAILED: timelineEvents is undefined</span>';
      console.error('timelineEvents is undefined');
    } else if (!Array.isArray(timelineEvents)) {
      dataLoadStatus.innerHTML = '<span class="error">❌ FAILED: timelineEvents is not an array</span>';
      console.error('timelineEvents is not an array:', typeof timelineEvents);
    } else {
      dataLoadStatus.innerHTML = `<span class="success">✅ SUCCESS: Loaded ${timelineEvents.length} events</span>`;
      console.log('Successfully loaded', timelineEvents.length, 'events');
    }

    // Test 2: Filtering
    const filterTests = document.getElementById('filter-tests');
    if (typeof timelineEvents !== 'undefined' && Array.isArray(timelineEvents)) {
      const filters = {
        'critical': e => e.tags && e.tags.includes('critical'),
        'ohs': e => e.tags && e.tags.includes('ohs'),
        'wrongful-dismissal': e => e.tags && e.tags.includes('wrongful-dismissal'),
        'smoking-gun': e => e.tags && e.tags.includes('smoking-gun'),
        'family': e => e.tags && e.tags.includes('family'),
        'disability': e => e.tags && e.tags.includes('disability'),
        'correspondence': e => e.tags && e.tags.includes('correspondence')
      };

      let html = '<table style="width: 100%; border-collapse: collapse;">';
      html += '<tr style="border-bottom: 2px solid #ddd;"><th style="text-align: left; padding: 8px;">Filter</th><th style="text-align: right; padding: 8px;">Count</th><th style="text-align: left; padding: 8px;">Status</th></tr>';

      for (const [name, fn] of Object.entries(filters)) {
        const filtered = timelineEvents.filter(fn);
        const status = filtered.length > 0 ?
          `<span class="success">✅ ${filtered.length} events</span>` :
          `<span class="error">❌ NO EVENTS</span>`;
        html += `<tr style="border-bottom: 1px solid #eee;"><td style="padding: 8px;">${name}</td><td style="text-align: right; padding: 8px;">${filtered.length}</td><td style="padding: 8px;">${status}</td></tr>`;
        console.log(`Filter ${name}:`, filtered.length, 'events');
      }

      html += '</table>';

      // Test "all" view
      html += `<p style="margin-top: 20px;"><strong>All events:</strong> <span class="success">${timelineEvents.length} events</span></p>`;

      filterTests.innerHTML = html;
    } else {
      filterTests.innerHTML = '<span class="error">Cannot run filter tests - data not loaded</span>';
    }

    // Test 3: Show sample event
    const eventSample = document.getElementById('event-sample');
    if (typeof timelineEvents !== 'undefined' && Array.isArray(timelineEvents) && timelineEvents.length > 0) {
      const sample = timelineEvents[0];
      eventSample.innerHTML = `
        <pre>${JSON.stringify(sample, null, 2)}</pre>
      `;
      console.log('Sample event:', sample);
    } else {
      eventSample.innerHTML = '<span class="error">No events to display</span>';
    }

    // Additional console output
    console.log('=== Timeline Debug Info ===');
    console.log('Total events:', timelineEvents ? timelineEvents.length : 0);
    console.log('Browser:', navigator.userAgent);
    console.log('Window size:', window.innerWidth, 'x', window.innerHeight);

    // Check for events without tags
    if (timelineEvents) {
      const noTags = timelineEvents.filter(e => !e.tags || e.tags.length === 0);
      if (noTags.length > 0) {
        console.warn('Events without tags:', noTags.length);
        noTags.forEach(e => console.log('  -', e.timestamp, e.text));
      }
    }
  </script>
</body>
</html>
